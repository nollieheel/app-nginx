# Generated by Chef for <%= node['fqdn'] %>
# Manual modifications will be removed at next Chef run
#

user                  <%= @process_user %><% if @process_group != @process_user %> <%= @process_group %><% end %>;
worker_processes      <%= @worker_processes %>;
error_log             <%= @nginx_log_dir %>/error.log;
pid                   <%= @pid %>;

<% if (node['platform'] == 'debian' && node['platform_version'].to_i >= 9) || (node['platform'] == 'ubuntu' && node['platform_version'].to_i >= 18) %>
include               /etc/nginx/modules-enabled/*.conf;
<% end -%>
<% if %w(amazon centos fedora).include?(node['platform']) -%>
include               /usr/share/nginx/modules/*.conf;
<% end -%>

events {
  worker_connections  <%= @worker_connections %>;
}

http {
  log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';

  access_log <%= @nginx_log_dir %>/access.log main;

  server_tokens <%= @server_tokens %>;
  sendfile      <%= @sendfile %>;
  tcp_nopush    <%= @tcp_nopush %>;
  tcp_nodelay   <%= @tcp_nodelay %>;

  keepalive_timeout         <%= @keepalive_timeout %>;
  keepalive_requests        <%= @keepalive_requests %>;
  reset_timedout_connection <%= @reset_timedout_connection %>;

  types_hash_max_size     <%= @types_hash_max_size %>;
  client_body_buffer_size <%= @client_body_buffer_size %>;
  client_max_body_size    <%= @client_max_body_size %>;

  include             <%= @nginx_dir %>/mime.types;
  default_type        application/octet-stream;

  include             <%= @nginx_dir %>/conf.d/*.conf;
  include             <%= @nginx_dir %>/conf.http.d/list*.conf;
}
